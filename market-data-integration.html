<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´ë°ì´í„° íˆ¬ì ì œì•ˆ ì‹œìŠ¤í…œ - ì‹œì¥ ë°ì´í„° ì—°ë™</title>
    
    <!-- ê°œë°œ ì¤‘ ìºì‹œ ë°©ì§€ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="If-Modified-Since" content="0">
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="ë„¤ì´ë²„í˜ì´ ì—°ë™ AI ê¸°ë°˜ ì‹¤ì‹œê°„ íˆ¬ì ë¦¬ë°¸ëŸ°ì‹± ì„œë¹„ìŠ¤">
    <meta name="theme-color" content="#03C75A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ë§ˆì´ë°ì´í„° íˆ¬ì">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="manifest.json">
    
    <!-- íŒŒë¹„ì½˜ ë° ì•„ì´ì½˜ -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/icon-120x120.png">
    
    <!-- ìŠ¤íƒ€ì¼ì‹œíŠ¸ (ìºì‹œ ë°©ì§€) -->
    <link rel="stylesheet" href="style.css" id="main-css">
    
    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- ì„±ëŠ¥ ìµœì í™” (ìºì‹œ ë°©ì§€) -->
    <script src="optimize.js" id="optimize-js"></script>
    
    <!-- ê°œë°œ ì¤‘ ìë™ ìºì‹œ ë°©ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ CSSì™€ JS íŒŒì¼ì— íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
        (function() {
            const timestamp = Date.now();
            
            // CSS íŒŒì¼ ìºì‹œ ë°©ì§€
            const cssLink = document.getElementById('main-css');
            if (cssLink) {
                cssLink.href = `style.css?v=${timestamp}`;
            }
            
            // JS íŒŒì¼ ìºì‹œ ë°©ì§€
            const jsScript = document.getElementById('optimize-js');
            if (jsScript) {
                jsScript.src = `optimize.js?v=${timestamp}`;
            }
            
            console.log(`ğŸ”„ ìºì‹œ ë°©ì§€ íƒ€ì„ìŠ¤íƒ¬í”„: ${timestamp}`);
        })();
    </script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸš€ ë§ˆì´ë°ì´í„° íˆ¬ì ì œì•ˆ ì‹œìŠ¤í…œ</h1>
            <div class="naverpay-logo">
                <!-- ë„¤ì´ë²„í˜ì´ ì‹œê·¸ë‹ˆì²˜ ë¡œê³  ìœ„ì¹˜ (ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ìŠ¹ì¸ëœ ë¡œê³  ì‚¬ìš©) -->
                <div class="logo-placeholder">Npay ì—°ë™</div>
            </div>
        </header>

        <main class="main">
            <!-- 1ë‹¨ê³„: í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ ì…ë ¥ -->
            <section class="section" id="portfolio-section">
                <h2>ğŸ“Š í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤</h2>
                <div class="portfolio-form">
                    <div class="form-group">
                        <label for="current-portfolio">ë³´ìœ  ì¢…ëª© ì…ë ¥:</label>
                        <textarea id="current-portfolio" placeholder="ì˜ˆì‹œ: ì‚¼ì„±ì „ì 10ì£¼, ì¹´ì¹´ì˜¤ 5, ë„¤ì´ë²„3 (ì£¼ ë‹¨ìœ„ ìƒëµ ê°€ëŠ¥)"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="investment-amount">ì´ íˆ¬ìê¸ˆì•¡:</label>
                        <input type="number" id="investment-amount" placeholder="10000000" min="0">
                        <span class="unit">ì›</span>
                    </div>
                    <button class="btn primary" onclick="analyzePortfolioSimple()">í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„</button>
                </div>
            </section>

            <!-- 2ë‹¨ê³„: ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„° -->
            <section class="section" id="market-section">
                <h2>ğŸ“ˆ ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„°</h2>
                <div class="market-controls">
                    <button class="btn secondary" onclick="fetchMarketData('yahoo')">ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ ë°ì´í„°</button>
                    <button class="btn secondary" onclick="fetchMarketData('kis')">KIS API ë°ì´í„°</button>
                    <button class="btn secondary" onclick="fetchMarketData('sample')">ìƒ˜í”Œ ë°ì´í„°</button>
                </div>
                
                <div class="market-data" id="market-data">
                    <div class="loading" id="loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>ì‹œì¥ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                    
                    <div class="stock-grid" id="stock-grid">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ì£¼ì‹ ë°ì´í„° -->
                    </div>
                </div>
            </section>

            <!-- 3ë‹¨ê³„: ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ -->
            <section class="section" id="rebalancing-section">
                <h2>âš–ï¸ ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ</h2>
                
                <!-- ë„¤ì´ë²„í˜ì´ í˜œíƒ ë°°ì§€ -->
                <div class="benefit-badge">
                    <span class="badge-text">Npay ê²°ì œ ì‹œ ìµœëŒ€ 2% ì ë¦½</span>
                </div>
                
                <div class="rebalancing-controls">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="risk-level">ìœ„í—˜ ìˆ˜ì¤€:</label>
                            <select id="risk-level">
                                <option value="conservative">ì•ˆì •í˜• (Conservative)</option>
                                <option value="moderate" selected>ê· í˜•í˜• (Moderate)</option>
                                <option value="aggressive">ê³µê²©í˜• (Aggressive)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="target-return">ëª©í‘œ ìˆ˜ìµë¥ :</label>
                            <div class="input-with-unit">
                                <input type="number" id="target-return" placeholder="8" min="1" max="30">
                                <span class="unit">%</span>
                            </div>
                        </div>
                    </div>
                    <button class="btn primary" onclick="generateRebalancingAdvice()">AI ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ</button>
                </div>
                
                <div class="rebalancing-result" id="rebalancing-result">
                    <!-- AI ìƒì„± ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <!-- ì°¨íŠ¸ ì˜ì—­ -->
                <div class="chart-container">
                    <canvas id="portfolioChart" width="800" height="400"></canvas>
                </div>
            </section>

            <!-- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ -->
            <section class="section" id="performance-section" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                <h2>ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</h2>
                <div class="performance-metrics">
                    <div class="metric-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                        <div class="metric-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9em; color: #6c757d;">í˜ì´ì§€ ë¡œë”© ì‹œê°„</div>
                            <div id="page-load-time" style="font-size: 1.5em; font-weight: bold; color: #03C75A;">ì¸¡ì • ì¤‘...</div>
                        </div>
                        <div class="metric-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9em; color: #6c757d;">API ì‘ë‹µ ì‹œê°„</div>
                            <div id="api-response-time" style="font-size: 1.5em; font-weight: bold; color: #17a2b8;">0ms</div>
                        </div>
                        <div class="metric-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9em; color: #6c757d;">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</div>
                            <div id="memory-usage" style="font-size: 1.5em; font-weight: bold; color: #ffc107;">N/A</div>
                        </div>
                        <div class="metric-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="font-size: 0.9em; color: #6c757d;">ë„¤íŠ¸ì›Œí¬ ìƒíƒœ</div>
                            <div id="network-status" style="font-size: 1.5em; font-weight: bold; color: #28a745;">ì–‘í˜¸</div>
                        </div>
                    </div>
                    <button class="btn secondary" onclick="showDetailedReport()" style="margin-top: 10px;">
                        ğŸ“ˆ ìƒì„¸ ì„±ëŠ¥ ë¦¬í¬íŠ¸ ë³´ê¸°
                    </button>
                </div>
            </section>

            <!-- 4ë‹¨ê³„: ì•¡ì…˜ í”Œëœ -->
            <section class="section" id="action-section">
                <h2>ğŸ“‹ ì‹¤í–‰ ê³„íš</h2>
                <div class="action-plan" id="action-plan">
                    <!-- êµ¬ì²´ì ì¸ ë§¤ë§¤ ì œì•ˆì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                
                <div class="export-options">
                    <button class="btn secondary" onclick="exportToPDF()">ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn secondary" onclick="saveToLocalStorage()">ğŸ’¾ ë¡œì»¬ ì €ì¥</button>
                    <button class="btn primary npay-button" onclick="connectNpay()">
                        <span class="npay-logo">N</span>
                        ë„¤ì´ë²„í˜ì´ ì—°ê²°
                    </button>
                </div>
            </section>
        </main>

        <!-- ë©´ì±…ì¡°í•­ -->
        <footer class="disclaimer">
            <p>âš ï¸ <strong>íˆ¬ì ìœ„í—˜ ê³ ì§€:</strong> ëª¨ë“  íˆ¬ìì—ëŠ” ì›ê¸ˆ ì†ì‹¤ì˜ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤. ì´ ì œì•ˆì€ ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ íˆ¬ì ê²°ì •ì€ ì‹ ì¤‘íˆ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
            <p>ğŸ“œ ê¸ˆìœµíˆ¬ìì—…ë²•ì— ë”°ë¼ íˆ¬ì ê¶Œìœ ê°€ ì•„ë‹Œ ì •ë³´ ì œê³µ ëª©ì ì…ë‹ˆë‹¤.</p>
        </footer>
    </div>

    <!-- ëª¨ë“  ê¸°ëŠ¥ì„ ì—¬ê¸°ì— í†µí•© -->
    <script>
        // ê°„ë‹¨í•œ í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ í•¨ìˆ˜ (ì‹¤ì‹œê°„ ë°ì´í„°)
        async function analyzePortfolioSimple() {
            console.log('ğŸ” ì‹¤ì‹œê°„ í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ ì‹œì‘');
            
            let portfolioText, investmentAmount;
            
            try {
                portfolioText = document.getElementById('current-portfolio').value;
                investmentAmount = document.getElementById('investment-amount').value;
                
                console.log('ğŸ“Š ì…ë ¥ê°’:', { portfolioText, investmentAmount });
                
                if (!portfolioText || !investmentAmount) {
                    alert('í¬íŠ¸í´ë¦¬ì˜¤ì™€ íˆ¬ìê¸ˆì•¡ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ë¡œë”© í‘œì‹œ
                showQuickNotification('ì‹¤ì‹œê°„ ì£¼ê°€ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                
                // ì‹¤ì‹œê°„ í¬íŠ¸í´ë¦¬ì˜¤ íŒŒì‹±
                const portfolio = await parsePortfolioQuick(portfolioText);
                const amount = parseInt(investmentAmount);
                
                console.log('ğŸ“Š ì‹¤ì‹œê°„ í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„°:', portfolio);
                
                // ê²°ê³¼ í‘œì‹œ
                displayAnalysisResult(portfolio, amount);
                
                // ì°¨íŠ¸ ìƒì„±
                createPortfolioChart(portfolio, amount);
                
                // ì‹¤ì‹œê°„ ë°ì´í„° ì‚¬ìš© ì—¬ë¶€ í‘œì‹œ
                const realTimeCount = Object.values(portfolio).filter(stock => stock.isRealTime).length;
                const totalCount = Object.keys(portfolio).length;
                
                if (realTimeCount === totalCount) {
                    showQuickNotification(`âœ… ë¶„ì„ ì™„ë£Œ! (ì‹¤ì‹œê°„ ë°ì´í„° ${realTimeCount}/${totalCount})`, 'success');
                } else if (realTimeCount > 0) {
                    showQuickNotification(`âš ï¸ ë¶„ì„ ì™„ë£Œ! (ì‹¤ì‹œê°„ ${realTimeCount}/${totalCount}, ë‚˜ë¨¸ì§€ëŠ” ì¶”ì •ê°€)`, 'warning');
                } else {
                    showQuickNotification('âš ï¸ ë¶„ì„ ì™„ë£Œ! (ì¶”ì • ë°ì´í„° ì‚¬ìš©)', 'warning');
                }
                
                
            } catch (error) {
                console.error('âŒ í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                return;
            }
        }
        
        // AI ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ í•¨ìˆ˜ (ì‹¤ì œ Gemini API)
        async function generateRebalancingAdvice() {
            console.log('ğŸ¤– ì‹¤ì œ AI ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ ì‹œì‘');
            
            try {
                // ìš”ì†Œ ì¡´ì¬ í™•ì¸ ë° ë°ì´í„° ìˆ˜ì§‘
                const riskElement = document.getElementById('risk-level');
                const targetReturnElement = document.getElementById('target-return');
                const portfolioElement = document.getElementById('current-portfolio');
                const investmentAmountElement = document.getElementById('investment-amount');
                
                if (!riskElement || !targetReturnElement || !portfolioElement || !investmentAmountElement) {
                    alert('í•„ìˆ˜ ì…ë ¥ í•­ëª©ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const riskTolerance = riskElement.value;
                const targetReturn = targetReturnElement.value;
                const portfolioText = portfolioElement.value;
                const investmentAmount = investmentAmountElement.value;
                
                console.log('ğŸ“Š ì…ë ¥ ë°ì´í„°:', { riskTolerance, targetReturn, portfolioText, investmentAmount });
                
                if (!riskTolerance || !targetReturn || !portfolioText || !investmentAmount) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ë¡œë”© í‘œì‹œ
                const resultDiv = document.getElementById('rebalancing-result');
                resultDiv.innerHTML = `
                    <div style="text-align: center; padding: 30px;">
                        <div class="spinner" style="margin: 0 auto 20px;"></div>
                        <p>ğŸ¤– AIê°€ ìµœì ì˜ ë¦¬ë°¸ëŸ°ì‹± ì „ëµì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                        <p style="font-size: 0.9em; color: #666;">ì‹¤ì‹œê°„ ì‹œì¥ ë°ì´í„°ì™€ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.</p>
                    </div>
                `;
                
                // í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ íŒŒì‹± (ì‹¤ì‹œê°„ ë°ì´í„° í¬í•¨)
                const portfolio = await parsePortfolioQuick(portfolioText);
                
                // Gemini AI API í˜¸ì¶œ
                const requestData = {
                    portfolio: portfolio,
                    riskLevel: riskTolerance,
                    targetReturn: parseFloat(targetReturn),
                    investmentAmount: parseInt(investmentAmount),
                    marketData: {
                        timestamp: new Date().toISOString(),
                        portfolioData: portfolio
                    }
                };
                
                console.log('ğŸ¤– Gemini AI API í˜¸ì¶œ ì¤‘...');
                
                const response = await fetch('/api/investment-advice', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': 'demo_key' // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì‹¤ì œ API í‚¤ ì‚¬ìš©
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('âœ… AI ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ ì™„ë£Œ');
                    
                    // AI ì œì•ˆ ê²°ê³¼ í‘œì‹œ
                    resultDiv.innerHTML = `
                        <div class="ai-advice-container">
                            <h3 style="color: #03C75A; margin-bottom: 20px;">ğŸ¤– AI ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ</h3>
                            <div class="advice-content" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                                ${result.advice.replace(/\n/g, '<br>')}
                            </div>
                            <div class="risk-warning" style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <strong>âš ï¸ íˆ¬ì ìœ„í—˜ ê³ ì§€:</strong><br>
                                ${result.riskWarning}
                            </div>
                            <div class="api-info" style="font-size: 0.8em; color: #666; margin-top: 10px; text-align: right;">
                                ìƒì„± ì‹œê°„: ${new Date(result.timestamp).toLocaleString()}<br>
                                ëª¨ë¸: ${result.apiUsage?.model || 'Gemini AI'} | ì‘ë‹µ ê¸¸ì´: ${result.apiUsage?.responseLength || 'N/A'}ì
                            </div>
                        </div>
                    `;
                    
                    showQuickNotification('âœ… AI ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                } else {
                    console.error('âŒ AI ì œì•ˆ ì‹¤íŒ¨:', result.error);
                    
                    if (result.error.includes('API í‚¤')) {
                        // API í‚¤ ì—†ì„ ë•Œ ë°ëª¨ ì œì•ˆ í‘œì‹œ
                        showDemoRebalancingAdvice(riskTolerance);
                        showQuickNotification('âš ï¸ ë°ëª¨ ëª¨ë“œ: ì‹¤ì œ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤', 'warning');
                    } else {
                        resultDiv.innerHTML = `
                            <div style="color: #dc3545; padding: 20px; text-align: center;">
                                <h4>âŒ AI ì œì•ˆ ìƒì„± ì‹¤íŒ¨</h4>
                                <p>${result.error}</p>
                                <button class="btn secondary" onclick="showDemoRebalancingAdvice('${riskTolerance}')">ë°ëª¨ ì œì•ˆ ë³´ê¸°</button>
                            </div>
                        `;
                        showQuickNotification('âŒ AI ì œì•ˆ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                    }
                }
                
            } catch (error) {
                console.error('AI ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ ì˜¤ë¥˜:', error);
                const resultDiv = document.getElementById('rebalancing-result');
                resultDiv.innerHTML = `
                    <div style="color: #dc3545; padding: 20px; text-align: center;">
                        <h4>âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</h4>
                        <p>AI ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${error.message}</p>
                        <button class="btn secondary" onclick="generateRebalancingAdvice()">ë‹¤ì‹œ ì‹œë„</button>
                    </div>
                `;
                showQuickNotification('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }
        
        // ë°ëª¨ ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ (ë°±ì—…ìš©)
        function showDemoRebalancingAdvice(riskTolerance) {
            const resultDiv = document.getElementById('rebalancing-result');
            console.log('ğŸ“Š ë°ëª¨ ë¦¬ë°¸ëŸ°ì‹± ì œì•ˆ í‘œì‹œ:', riskTolerance);
            
            if (!riskTolerance) {
                alert('ìœ„í—˜ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
                
                // ìƒì„¸í•œ ë¦¬ë°¸ëŸ°ì‹± ì¡°ì–¸ ìƒì„±
                const advice = {
                    conservative: `
                        <strong>ì•ˆì • ì¤‘ì‹¬ í¬íŠ¸í´ë¦¬ì˜¤ ê¶Œì¥:</strong><br>
                        â€¢ í•œêµ­ êµ­ê³ ì±„ê¶Œ 30%, íšŒì‚¬ì±„ 20%<br>
                        â€¢ ëŒ€í˜• ìš°ëŸ‰ì£¼ (ì‚¼ì„±ì „ì, LGí™”í•™) 30%<br>
                        â€¢ ë°°ë‹¹ì£¼ ë° ë¦¬ì¸  20%<br>
                        â€¢ ì˜ˆìƒ ìˆ˜ìµë¥ : ì—° 4-6%, ë³€ë™ì„± ë‚®ìŒ
                    `,
                    moderate: `
                        <strong>ê· í˜• ì¡íŒ í¬íŠ¸í´ë¦¬ì˜¤ ê¶Œì¥:</strong><br>
                        â€¢ êµ­ë‚´ ì£¼ì‹ 40% (ëŒ€í˜•ì£¼ 25%, ì¤‘ì†Œí˜•ì£¼ 15%)<br>
                        â€¢ í•´ì™¸ ì£¼ì‹ 20% (ë¯¸êµ­ ETF ìœ„ì£¼)<br>
                        â€¢ ì±„ê¶Œ 30% (êµ­ê³ ì±„, íšŒì‚¬ì±„ í˜¼í•©)<br>
                        â€¢ ëŒ€ì•ˆíˆ¬ì 10% (ë¦¬ì¸ , ì›ìì¬)<br>
                        â€¢ ì˜ˆìƒ ìˆ˜ìµë¥ : ì—° 6-8%, ì ì • ë³€ë™ì„±
                    `,
                    aggressive: `
                        <strong>ì„±ì¥ ì¤‘ì‹¬ í¬íŠ¸í´ë¦¬ì˜¤ ê¶Œì¥:</strong><br>
                        â€¢ êµ­ë‚´ ì„±ì¥ì£¼ 40% (ê¸°ìˆ ì£¼, ë°”ì´ì˜¤ í¬í•¨)<br>
                        â€¢ í•´ì™¸ ì„±ì¥ì£¼ 30% (ë‚˜ìŠ¤ë‹¥ ETF, ì‹ í¥êµ­)<br>
                        â€¢ í…Œë§ˆì£¼ 20% (AI, ë°˜ë„ì²´, ì‹ ì¬ìƒì—ë„ˆì§€)<br>
                        â€¢ í˜„ê¸ˆ 10% (ê¸°íšŒ íˆ¬ììš©)<br>
                        â€¢ ì˜ˆìƒ ìˆ˜ìµë¥ : ì—° 8-12%, ë†’ì€ ë³€ë™ì„± ê°ìˆ˜
                    `
                };
                
                const result = advice[riskTolerance] || "ìœ„í—˜ë„ì— ë§ëŠ” ì¡°ì–¸ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                console.log('ğŸ“Š ìƒì„±ëœ ì¡°ì–¸:', result);
                
                // ê²°ê³¼ í‘œì‹œ
                const resultContainer = document.getElementById('rebalancing-result');
                console.log('ğŸ“Š ê²°ê³¼ ì»¨í…Œì´ë„ˆ ì°¾ê¸°:', resultContainer);
                
                if (resultContainer) {
                    resultContainer.innerHTML = `
                        <div class="ai-advice" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #03C75A;">
                            <h4 style="color: #03C75A; margin-bottom: 15px;">ğŸ¤– AI ë¦¬ë°¸ëŸ°ì‹± ì¡°ì–¸</h4>
                            <p style="margin-bottom: 10px;"><strong>ì„ íƒí•œ ìœ„í—˜ë„:</strong> ${riskTolerance}</p>
                            <p style="margin-bottom: 15px; font-size: 16px; line-height: 1.5;"><strong>ì¡°ì–¸:</strong> ${result}</p>
                            <p style="color: #e74c3c; font-size: 0.9em; margin: 0;">âš ï¸ ì´ëŠ” ì˜ˆì‹œ ì¡°ì–¸ì…ë‹ˆë‹¤. ì‹¤ì œ íˆ¬ì ê²°ì • ì‹œ ì „ë¬¸ê°€ì™€ ìƒë‹´í•˜ì„¸ìš”.</p>
                        </div>
                    `;
                    resultContainer.style.display = 'block';
                    
                    // ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    console.log('âœ… ê²°ê³¼ í‘œì‹œ ë° ìŠ¤í¬ë¡¤ ì™„ë£Œ');
                } else {
                    console.error('âŒ rebalancing-result ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    alert('ê²°ê³¼ë¥¼ í‘œì‹œí•  ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                showQuickNotification('ğŸ¤– AI ë¦¬ë°¸ëŸ°ì‹± ì¡°ì–¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('âœ… AI ë¦¬ë°¸ëŸ°ì‹± í•¨ìˆ˜ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ AI ë¦¬ë°¸ëŸ°ì‹± ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // í¬íŠ¸í´ë¦¬ì˜¤ ì°¨íŠ¸ ìƒì„±
        let portfolioChart = null;
        
        function createPortfolioChart(portfolio, totalAmount) {
            console.log('ğŸ“Š ì°¨íŠ¸ ìƒì„± ì‹œì‘');
            
            const ctx = document.getElementById('portfolioChart');
            if (!ctx) {
                console.error('âŒ ì°¨íŠ¸ ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì‚­ì œ
            if (portfolioChart) {
                portfolioChart.destroy();
            }
            
            // ë°ì´í„° ì¤€ë¹„
            const labels = Object.keys(portfolio);
            const data = Object.values(portfolio).map(stock => stock.shares * stock.currentPrice);
            const colors = [
                '#03C75A', // ë„¤ì´ë²„í˜ì´ ê·¸ë¦°
                '#FF6B6B', // ë ˆë“œ
                '#4ECDC4', // í„°ì½°ì´ì¦ˆ
                '#45B7D1', // ë¸”ë£¨
                '#96CEB4', // ë¯¼íŠ¸
                '#FFEAA7', // ì˜ë¡œìš°
                '#DDA0DD', // í¼í”Œ
                '#F7DC6F'  // ê³¨ë“œ
            ];
            
            try {
                portfolioChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±',
                            data: data,
                            backgroundColor: colors.slice(0, labels.length),
                            borderColor: '#ffffff',
                            borderWidth: 2,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ìì‚° êµ¬ì„±',
                                font: {
                                    size: 18,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        size: 12
                                    },
                                    generateLabels: function(chart) {
                                        const data = chart.data;
                                        return data.labels.map((label, i) => {
                                            const value = data.datasets[0].data[i];
                                            const percentage = ((value / totalAmount) * 100).toFixed(1);
                                            return {
                                                text: `${label}: ${value.toLocaleString()}ì› (${percentage}%)`,
                                                fillStyle: data.datasets[0].backgroundColor[i],
                                                strokeStyle: data.datasets[0].borderColor,
                                                lineWidth: data.datasets[0].borderWidth,
                                                hidden: false,
                                                index: i
                                            };
                                        });
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const percentage = ((value / totalAmount) * 100).toFixed(1);
                                        return `${label}: ${value.toLocaleString()}ì› (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        animation: {
                            animateRotate: true,
                            duration: 1500
                        }
                    }
                });
                
                console.log('âœ… ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì°¨íŠ¸ ìƒì„± ì˜¤ë¥˜:', error);
                
                // ì°¨íŠ¸ ìƒì„± ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ë©”ì‹œì§€ í‘œì‹œ
                ctx.style.display = 'none';
                const container = ctx.parentElement;
                container.innerHTML = `
                    <div style="height: 400px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #6c757d; flex-direction: column;">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“Š</div>
                        <div>ì°¨íŠ¸ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">ë°ì´í„°ëŠ” ìœ„ì˜ ë¶„ì„ ê²°ê³¼ì—ì„œ í™•ì¸í•˜ì„¸ìš”</div>
                    </div>
                `;
            }
        }
        
        // ì„±ëŠ¥ ë¦¬í¬íŠ¸ í‘œì‹œ
        function showDetailedReport() {
            console.log('ğŸ“Š ìƒì„¸ ì„±ëŠ¥ ë¦¬í¬íŠ¸ ìš”ì²­');
            
            if (typeof getPerformanceReport === 'function') {
                const report = getPerformanceReport();
                
                const reportHtml = `
                    <div style="background: white; padding: 20px; border-radius: 10px; margin: 20px 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #03C75A; margin-bottom: 15px;">ğŸ“Š ì„±ëŠ¥ ë¶„ì„ ë¦¬í¬íŠ¸</h3>
                        <div style="margin-bottom: 15px;">
                            <h4>í˜„ì¬ ìƒíƒœ:</h4>
                            <ul style="list-style: none; padding: 0;">
                                <li>ğŸ“ˆ í˜ì´ì§€ ë¡œë”©: ${report.í˜„ì¬_ìƒíƒœ?.í˜ì´ì§€_ë¡œë”© || 'N/A'}</li>
                                <li>âš¡ í‰ê·  ë¡œë”©: ${report.í˜„ì¬_ìƒíƒœ?.í‰ê· _ë¡œë”© || 'N/A'}</li>
                                <li>ğŸŒ API í˜¸ì¶œìˆ˜: ${report.í˜„ì¬_ìƒíƒœ?.API_í˜¸ì¶œìˆ˜ || 0}</li>
                                <li>ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${report.í˜„ì¬_ìƒíƒœ?.ë©”ëª¨ë¦¬_ì‚¬ìš©ëŸ‰ || 'N/A'}</li>
                                <li>ğŸ“¶ ë„¤íŠ¸ì›Œí¬: ${report.í˜„ì¬_ìƒíƒœ?.ë„¤íŠ¸ì›Œí¬ || 'N/A'}</li>
                            </ul>
                        </div>
                        <div>
                            <h4>ê¶Œì¥ì‚¬í•­:</h4>
                            <ul>
                                ${report.ê¶Œì¥ì‚¬í•­?.map(suggestion => `<li>${suggestion}</li>`).join('') || '<li>ë°ì´í„° ìˆ˜ì§‘ ì¤‘...</li>'}
                            </ul>
                        </div>
                        <button onclick="this.parentElement.style.display='none'" style="margin-top: 10px; padding: 5px 10px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">ë‹«ê¸°</button>
                    </div>
                `;
                
                const existingReport = document.querySelector('.performance-report');
                if (existingReport) {
                    existingReport.remove();
                }
                
                const reportDiv = document.createElement('div');
                reportDiv.className = 'performance-report';
                reportDiv.innerHTML = reportHtml;
                
                const performanceSection = document.getElementById('performance-section');
                performanceSection.appendChild(reportDiv);
                
                reportDiv.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('ì„±ëŠ¥ ë¦¬í¬íŠ¸ ì‹œìŠ¤í…œì´ ì•„ì§ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ì‹¤ì‹œê°„ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
        function updatePerformanceMetrics() {
            // í˜ì´ì§€ ë¡œë”© ì‹œê°„ ì—…ë°ì´íŠ¸
            if (typeof performance !== 'undefined' && performance.timing) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                if (loadTime > 0) {
                    document.getElementById('page-load-time').textContent = `${loadTime}ms`;
                }
            }
            
            // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸
            if (performance.memory) {
                const memoryUsage = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                document.getElementById('memory-usage').textContent = `${memoryUsage}MB`;
            }
            
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì—…ë°ì´íŠ¸
            if (navigator.connection) {
                const connection = navigator.connection;
                const networkType = connection.effectiveType || 'unknown';
                document.getElementById('network-status').textContent = networkType;
            }
        }
        
        // ê°œì„ ëœ í¬íŠ¸í´ë¦¬ì˜¤ íŒŒì‹± (ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ)
        async function parsePortfolioQuick(text) {
            const portfolio = {};
            const lines = text.split(/[,\n]/);
            
            // ì£¼ì‹ ì´ë¦„ê³¼ ì£¼ìˆ˜ë¥¼ ë¨¼ì € íŒŒì‹±
            const stockList = [];
            lines.forEach(line => {
                const trimmed = line.trim();
                if (trimmed) {
                    // íŒ¨í„´ 1: "ì‚¼ì„±ì „ì 10ì£¼" í˜•íƒœ
                    let match = trimmed.match(/(.+?)\s*(\d+)\s*ì£¼/);
                    
                    if (match) {
                        const stockName = match[1].trim();
                        const shares = parseInt(match[2]);
                        stockList.push({ stockName, shares });
                    } else {
                        // íŒ¨í„´ 2: "ì‚¼ì„±ì „ì 10" í˜•íƒœ (ì£¼ ì—†ì´ ìˆ«ìë§Œ)
                        match = trimmed.match(/(.+?)\s+(\d+)$/);
                        
                        if (match) {
                            const stockName = match[1].trim();
                            const shares = parseInt(match[2]);
                            stockList.push({ stockName, shares });
                        } else {
                            // íŒ¨í„´ 3: "ì‚¼ì„±ì „ì10" í˜•íƒœ (ê³µë°± ì—†ì´)
                            match = trimmed.match(/^(.+?)(\d+)$/);
                            
                            if (match && match[1].length > 1) { // ì¢…ëª©ëª…ì´ ìµœì†Œ 2ê¸€ì ì´ìƒ
                                const stockName = match[1].trim();
                                const shares = parseInt(match[2]);
                                
                                // ì¢…ëª©ëª…ì´ ìˆ«ìë¡œë§Œ êµ¬ì„±ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì¶”ê°€
                                if (!/^\d+$/.test(stockName)) {
                                    stockList.push({ stockName, shares });
                                }
                            }
                        }
                    }
                }
            });
            
            // ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ (ë³‘ë ¬ ì²˜ë¦¬)
            console.log('ğŸ“Š ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ ì‹œì‘...');
            const pricePromises = stockList.map(async ({ stockName, shares }) => {
                const priceData = await getRealTimePrice(stockName);
                return {
                    stockName,
                    shares,
                    currentPrice: priceData.price,
                    marketData: priceData
                };
            });
            
            try {
                const results = await Promise.all(pricePromises);
                results.forEach(({ stockName, shares, currentPrice, marketData }) => {
                    portfolio[stockName] = { 
                        shares, 
                        currentPrice,
                        marketData,
                        isRealTime: !marketData.fallback
                    };
                });
                
                console.log('ğŸ“Š ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ ì™„ë£Œ:', portfolio);
            } catch (error) {
                console.error('âŒ ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ ë°±ì—… ë°ì´í„° ì‚¬ìš©
                stockList.forEach(({ stockName, shares }) => {
                    portfolio[stockName] = { 
                        shares, 
                        currentPrice: getEstimatedPrice(stockName),
                        isRealTime: false
                    };
                });
            }
            
            return portfolio;
        }
        
        // ìˆ«ìë¥¼ í•œêµ­ì‹ ì‰¼í‘œ í‘œê¸°ë¡œ ë³€í™˜
        function formatKoreanNumber(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        // ì‹¤ì œ ì£¼ì‹ ê°€ê²© ì¡°íšŒ (Yahoo Finance API)
        async function getRealTimePrice(stockName) {
            try {
                console.log(`ğŸ“Š ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ: ${stockName}`);
                
                const response = await fetch(`/api/yahoo-finance/${encodeURIComponent(stockName)}`);
                const data = await response.json();
                
                if (data.success && data.price > 0) {
                    console.log(`âœ… ${stockName} ì‹¤ì‹œê°„ ê°€ê²©: ${data.price}ì›`);
                    return {
                        price: data.price,
                        change: data.change,
                        changePercent: data.changePercent,
                        volume: data.volume,
                        marketState: data.marketState,
                        lastUpdate: data.lastUpdateTime
                    };
                } else {
                    console.warn(`âš ï¸ ${stockName} ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©`);
                    return { price: getEstimatedPrice(stockName), fallback: true };
                }
            } catch (error) {
                console.error(`âŒ ${stockName} ê°€ê²© ì¡°íšŒ ì˜¤ë¥˜:`, error);
                return { price: getEstimatedPrice(stockName), fallback: true };
            }
        }
        
        // ì˜ˆìƒ ì£¼ê°€ (ë°±ì—…ìš©)
        function getEstimatedPrice(stockName) {
            const prices = {
                'ì‚¼ì„±ì „ì': 71900,
                'ì¹´ì¹´ì˜¤': 54200,
                'ë„¤ì´ë²„': 195000,
                'SKí•˜ì´ë‹‰ìŠ¤': 128500,
                'LGí™”í•™': 378000,
                'NAVER': 195000,
                'Kakao': 54200
            };
            return prices[stockName] || 50000;
        }
        
        // ë¶„ì„ ê²°ê³¼ í‘œì‹œ (í•œêµ­ì‹ ì‰¼í‘œ í‘œê¸° ì ìš©)
        function displayAnalysisResult(portfolio, totalAmount) {
            const stockGrid = document.getElementById('stock-grid');
            if (!stockGrid) return;
            
            let html = '<h3>ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ ê²°ê³¼</h3>';
            let portfolioValue = 0;
            
            Object.entries(portfolio).forEach(([name, data]) => {
                const value = data.shares * data.currentPrice;
                portfolioValue += value;
                
                html += `
                    <div class="stock-card">
                        <h4>${name}</h4>
                        <p>ë³´ìœ : ${formatKoreanNumber(data.shares)}ì£¼</p>
                        <p>í˜„ì¬ê°€: ${formatKoreanNumber(data.currentPrice)}ì›</p>
                        <p>í‰ê°€ê¸ˆì•¡: ${formatKoreanNumber(value)}ì›</p>
                        <p>ë¹„ì¤‘: ${((value / totalAmount) * 100).toFixed(1)}%</p>
                    </div>
                `;
            });
            
            html += `
                <div class="analysis-summary">
                    <h4>ğŸ’¡ ë¶„ì„ ìš”ì•½</h4>
                    <p>ì´ íˆ¬ìê¸ˆì•¡: ${formatKoreanNumber(totalAmount)}ì›</p>
                    <p>í˜„ì¬ í‰ê°€ê¸ˆì•¡: ${formatKoreanNumber(portfolioValue)}ì›</p>
                    <p>ì†ìµ: ${formatKoreanNumber(portfolioValue - totalAmount)}ì›</p>
                    <p>ìˆ˜ìµë¥ : ${(((portfolioValue - totalAmount) / totalAmount) * 100).toFixed(2)}%</p>
                </div>
                
                <div class="ai-advice">
                    <h4>ğŸ¤– AI íˆ¬ì ì¡°ì–¸</h4>
                    <p>í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ëŠ” ê¸°ìˆ ì£¼ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                    <p>ì ì ˆí•œ ë¶„ì‚°íˆ¬ìê°€ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë‚˜, ì„¹í„° ì§‘ì¤‘ë„ê°€ ë†’ìŠµë‹ˆë‹¤.</p>
                    <p>ì •ê¸°ì ì¸ ë¦¬ë°¸ëŸ°ì‹±ì„ í†µí•´ ìœ„í—˜ì„ ê´€ë¦¬í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
                    <p style="color: #e74c3c;">âš ï¸ íˆ¬ìì—ëŠ” ì›ê¸ˆ ì†ì‹¤ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            `;
            
            stockGrid.innerHTML = html;
            stockGrid.style.display = 'block';
        }
        
        // ë¹ ë¥¸ ì•Œë¦¼ (íƒ€ì…ë³„ ìƒ‰ìƒ ì§€ì›)
        function showQuickNotification(message, type = 'success') {
            const notification = document.createElement('div');
            
            // íƒ€ì…ë³„ ìƒ‰ìƒ ì„¤ì •
            const colors = {
                success: '#03C75A',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };
            
            const backgroundColor = colors[type] || colors.success;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${backgroundColor};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: 600;
                max-width: 300px;
                word-wrap: break-word;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            // ìë™ ì œê±°
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œì‘ (ê¸°ë³¸ê°’ ì œê±°)
        document.addEventListener('DOMContentLoaded', () => {
            console.log('âœ… í˜ì´ì§€ ë¡œë”© ì™„ë£Œ - ê¸°ë³¸ê°’ ì—†ì´ ì‹œì‘');
            
            // ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸ ì‹œì‘
            setTimeout(() => {
                updatePerformanceMetrics();
                setInterval(updatePerformanceMetrics, 5000); // 5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
            }, 1000);
            
            // ê°œë°œ í™˜ê²½ì—ì„œ ìºì‹œ ë°©ì§€ í™•ì¸
            if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                console.log('ğŸ”„ ê°œë°œ í™˜ê²½: ìºì‹œ ë°©ì§€ ëª¨ë“œ í™œì„±í™”');
                
                // í˜ì´ì§€ íƒ€ì´í‹€ì— ë¡œë“œ ì‹œê°„ í‘œì‹œ (ê°œë°œìš©)
                const loadTime = new Date().toLocaleTimeString();
                document.title = `${document.title} - ${loadTime}`;
            }
        });
    </script>
    
    <!-- PWA ì„¤ì¹˜ ë° ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ -->
    <script>
        // PWA ì„¤ì¹˜ ê¸°ëŠ¥
        let deferredPrompt;
        let installButton;

        // PWA ì„¤ì¹˜ ë²„íŠ¼ ìƒì„±
        function createInstallButton() {
            if (installButton) return;
            
            installButton = document.createElement('button');
            installButton.className = 'btn npay-button pwa-install-btn';
            installButton.innerHTML = '<span class="npay-logo">ğŸ“±</span>ì•±ìœ¼ë¡œ ì„¤ì¹˜';
            installButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(3, 199, 90, 0.3);
                border-radius: 25px;
                font-size: 14px;
                padding: 12px 20px;
            `;
            
            installButton.addEventListener('click', installPWA);
            document.body.appendChild(installButton);
        }

        // PWA ì„¤ì¹˜ ì‹¤í–‰
        async function installPWA() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤.');
                showNotification('ì•± ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! í™ˆ í™”ë©´ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.', 'success');
            } else {
                console.log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.');
            }
            
            deferredPrompt = null;
            if (installButton) {
                installButton.remove();
                installButton = null;
            }
        }

        // ì„¤ì¹˜ ê°€ëŠ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            createInstallButton();
        });

        // ì•± ì„¤ì¹˜ ì™„ë£Œ ì´ë²¤íŠ¸
        window.addEventListener('appinstalled', () => {
            console.log('PWAê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
            showNotification('ë§ˆì´ë°ì´í„° íˆ¬ì ì•±ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
            if (installButton) {
                installButton.remove();
                installButton = null;
            }
        });

        // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë¹„í™œì„±í™”)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                // ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ ìºì‹œ ë°©ì§€
                if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                    console.log('ğŸ”„ ê°œë°œ í™˜ê²½: ì„œë¹„ìŠ¤ ì›Œì»¤ ë¹„í™œì„±í™” (ìºì‹œ ë°©ì§€)');
                    
                    // ê¸°ì¡´ ì„œë¹„ìŠ¤ ì›Œì»¤ ì œê±°
                    try {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        registrations.forEach(registration => {
                            registration.unregister();
                            console.log('ê¸°ì¡´ ì„œë¹„ìŠ¤ ì›Œì»¤ ì œê±°ë¨');
                        });
                    } catch (error) {
                        console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ì œê±° ì‹¤íŒ¨:', error);
                    }
                    return;
                }
                
                // í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œë§Œ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
                try {
                    const registration = await navigator.serviceWorker.register('sw.js');
                    console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì„±ê³µ:', registration.scope);
                    
                    // ì„œë¹„ìŠ¤ ì›Œì»¤ ì—…ë°ì´íŠ¸ í™•ì¸
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showUpdateNotification();
                            }
                        });
                    });
                    
                } catch (error) {
                    console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:', error);
                }
            });
        }

        // ì—…ë°ì´íŠ¸ ì•Œë¦¼ í‘œì‹œ
        function showUpdateNotification() {
            const updateBanner = document.createElement('div');
            updateBanner.className = 'update-banner';
            updateBanner.innerHTML = `
                <div style="background: var(--npay-green); color: white; padding: 12px 20px; text-align: center; position: fixed; top: 0; left: 0; right: 0; z-index: 9999;">
                    <span>ìƒˆ ì—…ë°ì´íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤!</span>
                    <button onclick="refreshApp()" style="background: white; color: var(--npay-green); border: none; padding: 4px 12px; margin-left: 12px; border-radius: 4px; cursor: pointer;">
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button onclick="this.parentElement.remove()" style="background: transparent; color: white; border: 1px solid white; padding: 4px 12px; margin-left: 8px; border-radius: 4px; cursor: pointer;">
                        ë‚˜ì¤‘ì—
                    </button>
                </div>
            `;
            document.body.appendChild(updateBanner);
        }

        // ì•± ìƒˆë¡œê³ ì¹¨
        function refreshApp() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    registration.waiting?.postMessage({ type: 'SKIP_WAITING' });
                });
                window.location.reload();
            }
        }

        // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--npay-green)' : 'var(--info)'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ì• ë‹ˆë©”ì´ì…˜ CSS ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            .pwa-install-btn {
                transition: all 0.3s ease;
            }
            .pwa-install-btn:hover {
                transform: scale(1.05);
            }
        `;
        document.head.appendChild(style);

        // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§
        window.addEventListener('online', () => {
            showNotification('ì¸í„°ë„· ì—°ê²°ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        });

        window.addEventListener('offline', () => {
            showNotification('ì˜¤í”„ë¼ì¸ ëª¨ë“œì…ë‹ˆë‹¤. ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'warning');
        });

        // ì•± ë²„ì „ ì²´í¬
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(registration => {
                const channel = new MessageChannel();
                channel.port1.onmessage = event => {
                    console.log('ì•± ë²„ì „:', event.data.version);
                };
                registration.active?.postMessage({ type: 'GET_VERSION' }, [channel.port2]);
            });
        }
    </script>
</body>
</html>
